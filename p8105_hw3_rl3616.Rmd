---
title: "p8105_hw3_rl3616"
author: "Ruipeng Li"
date: "`r format(Sys.Date())`"
output: github_document
---

# Problem 1

Loading data
```{r}
library(p8105.datasets)
library(dplyr)
library(ggplot2)
library(tidyr)
data("instacart") 
```

#### Part a)
The Instacart dataset contains 1,384,617 observations and 15 variables, representing individual items from customersâ€™ grocery orders.

Each observation corresponds to one product within an order, with variables describing the order time `order_hour_of_day`, date in week `order_dow`, customer `user_id`, product details `product_name, aisle, department`, and purchase behavior `add_to_cart_order, reordered, days_since_prior_order`.

The dataset allows exploration of shopping habits such as the most popular aisles, frequently reordered products, and peak shopping hours.

#### Part b)
Also, there are `r n_distinct(instacart$aisle)` different aisles in the dataset, and 
```{r}
top_aisles <- instacart |> 
  count(aisle, sort = TRUE)
```

With this data, we can see the top 1 aisle that most items ordered from was "`r top_aisles$aisle[1]`" and follow up with "`r top_aisles$aisle[2]`" and "`r top_aisles$aisle[3]`"

#### Part c)
```{r}
aisle_plot <- top_aisles |> 
  filter(n > 10000) |> 
  ggplot(aes(x = reorder(aisle, n), y = n)) +
  geom_col(width = 0.7, fill = "steelblue") +
  geom_text(aes(label = scales::comma(n)), 
            hjust = -0.1, size = 2.5) +
  coord_flip() +
  labs(
    title = "Aisles with more than 10,000 items ordered",
       x = "Aisle", y = "Number of items ordered"
    ) +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal(base_size = 8)

ggsave("figures/Problem 1/aisle_plot.png", aisle_plot, width = 10, dpi = 300)
```

#### Part d)
```{r}
top_item_table <- instacart |> 
  filter(aisle %in% c("baking ingredients", "dog food care", "packaged vegetables fruits")) |> 
  group_by(aisle, product_name) |>
  summarise(times_ordered = n()) |> 
  slice_max(times_ordered, n = 3)
```

#### Part e)
```{r}
mean_hour_table <- instacart |> 
  filter(product_name %in% c("Pink Lady Apples", "Coffee Ice Cream")) |> 
  group_by(product_name, order_dow) |> 
  summarise(mean_hour = mean(order_hour_of_day)) |> 
  mutate(order_dow = factor(order_dow,
    levels = 0:6,
    labels = c("Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday")
  )) |>
  pivot_wider(
    names_from = order_dow,
    values_from = mean_hour
  )
```

